<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Knitting Row Counter</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Knitting Row Counter</h2>
  <p id="rowDisplay">Row: 0</p>

  <!-- Row counter buttons -->
  <div class="row-buttons">
    <button onclick="nextRow()">Next Row</button>
    <button onclick="backRow()">Back</button>
    <button onclick="resetCounter()">Reset</button>
  </div>

  <!-- Voice control buttons -->
  <div class="voice-buttons">
    <button class="start-btn" onclick="startListening()">ðŸŽ¤ Start Voice Control</button>
    <button class="stop-btn" onclick="stopListening()">ðŸ›‘ Stop Voice Control</button>
  </div>

  <script>
    let row = 0;

    function updateDisplay() {
      document.getElementById("rowDisplay").textContent = "Row: " + row;
    }

    function nextRow() {
      row++;
      updateDisplay();
    }

    function backRow() {
      if (row > 0) row--;
      updateDisplay();
    }

    function resetCounter() {
      row = 0;
      updateDisplay();
    }

    // Voice control setup
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;

    if (recognition) {
      recognition.lang = 'en-GB';
      recognition.interimResults = true;
      recognition.maxAlternatives = 1;

      let keepListening = false;

      function startListening() {
        keepListening = true;
        try { recognition.start(); } catch (e) {}
      }

      function stopListening() {
        keepListening = false;
        recognition.stop();
      }

      recognition.onend = () => {
        if (keepListening) {
          setTimeout(() => { try { recognition.start(); } catch (e) {} }, 200);
        }
      };

      recognition.onresult = (event) => {
        const transcript = Array.from(event.results)
          .map(r => r[0].transcript)
          .join(' ')
          .toLowerCase();

        if (transcript.includes("next")) nextRow();
        if (transcript.includes("back")) backRow();
        if (transcript.includes("reset")) resetCounter();
      };
    } else {
      function startListening() { alert("Speech recognition not supported."); }
      function stopListening() { alert("Speech recognition not supported."); }
    }
  </script>
</body>
</html>
